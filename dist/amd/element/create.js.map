{"version":3,"sources":["../../../src/element/create.js"],"names":[],"mappings":"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","file":"src/element/create.js","sourcesContent":["'use strict';\nvar conv = require('yaf').conventions;\nvar tagReady = require('yaf/interfaces/common/tagReadyContext');\nvar getOptionsValues = require('yaf/utils/getOptionsValues');\nvar attachStyles = require('yaf/utils/attachStyles');\nvar detachStyles = require('yaf/utils/detachStyles');\nvar injectorReady = require('yaf/interfaces/common/injectorReadyContext');\nvar templateReady = require('yaf/interfaces/common/templateReadyContext');\nvar extend = require('extend');\n\n// use angular directive syntax to define element\nmodule.exports = function elementDirectiveFactory(definition) {\n\n  function directiveFactory(ElementState, channels) {\n\n    // get all injected services\n    var injectedCustomServices = Array.prototype.slice.call(arguments, 2);\n\n    // todo mix options in?\n    var angularDirectiveScope = {\n      state: '=',\n      channel: '@'\n    };\n\n    return {\n      restrict: 'E',\n      template: definition.template,\n      compile: function (tEl, tAttr) {\n        if (!tAttr.state) {\n          console.log('Warning! It seems you forgot to specify state attribute for \\'' +\n            definition.name + '\\' element!');\n        }\n\n        return {\n          pre: function (scope, el, attrs) {\n            if (!scope.state) {\n              scope.state = new ElementState();\n            }\n            var styles;\n\n            if (definition.styles) {\n              styles = attachStyles(definition.styles);\n            }\n\n            if (scope.channel) {\n              var channelNames = scope.channel.split(' ');\n              channelNames.forEach(function (channel) {\n                channels.get(channel).linkWith(scope, scope.state);\n              });\n            }\n\n            if (definition.styles) {\n              scope.$on('$destroy', function () {\n                detachStyles(styles);\n              });\n            }\n\n            // collect the interpolated option values from attrs\n            var opts = getOptionsValues(attrs);\n\n\n            var readyContext = extend(\n              tagReady(el, scope.state, opts),\n              templateReady(scope),\n              injectorReady(injectedCustomServices, definition.injectables)\n            );\n            // call the ready with all tagReady and injectorReady fields\n            definition.ready.apply(readyContext);\n          },\n          post: function(){}\n        };\n      },\n      scope: angularDirectiveScope\n    };\n  }\n\n  var stateName = conv.names.state(definition.name);\n\n  directiveFactory.$inject =\n    [stateName, conv.globalNames.channels]\n      .concat(definition.injectables);\n\n  definition.component = directiveFactory;\n  return definition;\n};"]}