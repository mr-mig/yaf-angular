{"version":3,"sources":["../../../src/composite/create.js"],"names":[],"mappings":"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","file":"src/composite/create.js","sourcesContent":["'use strict';\nvar conv = require('yaf').conventions;\nvar extend = require('extend');\nvar tagReady = require('yaf/interfaces/common/tagReadyContext');\nvar compositeReady = require('yaf/interfaces/common/compositeReadyContext');\nvar getOptionsValues = require('yaf/utils/getOptionsValues');\nvar linkInterface = require('yaf/interfaces/behavioural/link');\nvar channelsInterface = require('yaf/interfaces/behavioural/channel');\nvar styleRef = require('yaf/utils/refCountStyles');\nvar injectorReady = require('yaf/interfaces/common/injectorReadyContext');\nvar templateReady = require('yaf/interfaces/common/templateReadyContext');\n\n\nmodule.exports = function compositeDirectiveFactory(definition, state) {\n\n  function directiveFactory(CompositeState, channels, linkFn) {\n\n    // get all injected services\n    var injectedCustomServices = Array.prototype.slice.call(arguments, 3);\n\n    // todo mix options in?\n    var angularDirectiveScope = {\n      state: '=',\n      channel: '@'\n    };\n\n    return {\n      restrict: 'E',\n      template: definition.template,\n      compile: function (tEl, tAttr) {\n        if (!tAttr.state) {\n          console.log('Warning! It seems you forgot to specify state attribute for \\'' +\n            definition.name + '\\' element!');\n        }\n\n        return {\n          pre: function (scope, el, attrs) {\n            if (!scope.state) {\n              scope.state = new CompositeState();\n            }\n\n            var styles;\n            if (definition.styles) {\n              styles = styleRef.attachStyles(definition.name, definition.styles);\n            }\n\n            if (scope.channel) {\n              var channelNames = scope.channel.split(' ');\n              channelNames.forEach(function (channel) {\n                channels.get(channel).linkWith(scope, scope.state);\n              });\n            }\n\n            if (definition.styles) {\n              scope.$on('$destroy', function () {\n                styleRef.detachStyles(definition.name, styles);\n              });\n            }\n\n            // collect the interpolated option values from attrs\n            var opts = getOptionsValues(attrs);\n\n            var readyContext = extend(\n              tagReady(el, scope.state, opts),\n              templateReady(scope),\n              injectorReady(injectedCustomServices, definition.injectables),\n              compositeReady(linkFn, channels)\n            );\n\n            definition.ready.apply(readyContext);\n          },\n          post: function () {\n          }\n        };\n      },\n      scope: angularDirectiveScope\n    };\n  }\n\n  var stateName = conv.names.state(definition.name);\n\n  // inject all composite-specific services\n  directiveFactory.$inject =\n    [ stateName,\n      channelsInterface().entityName,\n      linkInterface().entityName\n    ].concat(definition.injectables);\n\n  definition.component = directiveFactory;\n  return definition;\n};\n"]}